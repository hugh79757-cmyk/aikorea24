# aikorea24 백업 (2026-02-13)
# 파일: 4개
==================================================

## 파일
- api_test/requirements.txt
- .gitignore
- api_test/env_template.sh
- api_test/news_collector.py


==================================================
# api_test/requirements.txt
==================================================
requests>=2.31.0
pytrends>=4.9.0
openai>=1.30.0
beautifulsoup4>=4.12.0
Pillow>=10.0.0
python-dotenv>=1.0.0

==================================================
# .gitignore
==================================================
# build output
dist/
# generated types
.astro/

# dependencies
node_modules/

# logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# environment variables
.env
.env.production

# macOS-specific files
.DS_Store

# jetbrains setting folder
.idea/
api_test/.env.sh

==================================================
# api_test/env_template.sh
==================================================
#!/bin/bash
# ============================================
# aikorea24.kr API 키 설정 템플릿
# 이 파일을 .env.sh로 복사 후 실제 키 입력
# cp env_template.sh .env.sh
# ============================================

# [1] 네이버 개발자센터 (https://developers.naver.com/apps/)
# - 사용 API: 검색(뉴스,블로그), 데이터랩(검색어트렌드)
export NAVER_CLIENT_ID=***
export NAVER_CLIENT_SECRET=***

# [2] 네이버 검색광고 API (https://manage.searchad.naver.com/)
# - 사용 API: 키워드도구 (월간검색량)
export NAVER_AD_API_KEY=***
export NAVER_AD_SECRET=***
export NAVER_AD_CUSTOMER_ID="YOUR_CUSTOMER_ID"

# [3] OpenAI API (https://platform.openai.com/api-keys)
# - 사용 모델: gpt-4o-mini (뉴스 요약)
export OPENAI_API_KEY=***

# [4] 공공데이터포털 (https://www.data.go.kr/)
# - 사용 API: 보조금통합포털, 공공서비스(혜택)
export DATA_GO_KR_KEY="YOUR_DATA_GO_KR_KEY"

# [5] Instagram Graph API (https://developers.facebook.com/)
# - 사용: 카드뉴스 자동 게시
export INSTAGRAM_ACCESS_TOKEN=***
export INSTAGRAM_BUSINESS_ID="YOUR_IG_BUSINESS_ID"

==================================================
# api_test/news_collector.py
==================================================
#!/usr/bin/env python3

import os, json, subprocess, urllib.request, urllib.parse
from datetime import datetime
from xml.etree import ElementTree as ET
from html import unescape
import re

# === 환경변수 로드 ===
def load_env(path):
    with open(path) as f:
        for line in f:
            line = line.strip()
            if line.startswith('#') or '=' not in line:
                continue
            line = line.replace('export ', '')
            key, val = line.split('=', 1)
            os.environ[key.strip()] = val.strip().strip('"').strip("'")

load_env('/Users/twinssn/Projects/aikorea24/api_test/.env.sh')

PROJECT_DIR = '/Users/twinssn/Projects/aikorea24'
NAVER_ID =***
NAVER_SECRET =***
DATA_KEY = os.environ.get('DATA_GO_KR_KEY', '')

def clean(text):
    text = unescape(text or '')
    return re.sub(r'<[^>]+>', '', text).strip()

# === 1. 과기부 사업공고 (AI 키워드 필터) ===
def fetch_msit_announcements(limit=20):
    url = f"http://apis.data.go.kr/1721000/msitannouncementinfo/businessAnnouncMentList?ServiceKey={DATA_KEY}&pageNo=1&numOfRows={limit}&returnType=json"
    req = urllib.request.Request(url, headers={'User-Agent': 'Mozilla/5.0'})
    try:
        data = json.loads(urllib.request.urlopen(req, timeout=10).read())
        items = data['response'][1]['body']['items']
        results = []
        keywords = ['AI', '인공지능', '디지털', '데이터', '클라우드', '소프트웨어', '바우처']
        for entry in items:
            item = entry['item']
            title = clean(item.get('subject', ''))
            if any(k in title for k in keywords):
                results.append({
                    'title': title,
                    'link': item.get('viewUrl', ''),
                    'description': f"담당: {item.get('deptName','')} | {item.get('managerName','')} {item.get('managerTel','')}",
                    'source': '과기부 사업공고',
                    'category': 'grant',
                    'pub_date': item.get('pressDt', '')
                })
        print(f"  과기부 사업공고: {len(results)}건 (AI 관련)")
        return results
    except Exception as e:
        print(f"  과기부 사업공고 실패: {e}")
        return []

# === 2. 과기부 보도자료 ===
def fetch_msit_press(limit=10):
    url = f"http://apis.data.go.kr/1721000/msitpressreleaseinfo/pressReleaseList?ServiceKey={DATA_KEY}&pageNo=1&numOfRows={limit}&returnType=json"
    req = urllib.request.Request(url, headers={'User-Agent': 'Mozilla/5.0'})
    try:
        data = json.loads(urllib.request.urlopen(req, timeout=10).read())
        items = data['response'][1]['body']['items']
        results = []
        for entry in items:
            item = entry['item']
            results.append({
                'title': clean(item.get('subject', '')),
                'link': item.get('viewUrl', ''),
                'description': f"담당: {item.get('deptName','')}",
                'source': '과기부 보도자료',
                'category': 'policy',
                'pub_date': item.get('pressDt', '')
            })
        print(f"  과기부 보도자료: {len(results)}건")
        return results
    except Exception as e:
        print(f"  과기부 보도자료 실패: {e}")
        return []

# === 3. 행정안전부 공공서비스(혜택) ===
def fetch_gov_benefits(limit=10):
    url = f"https://api.odcloud.kr/api/gov24/v3/serviceList?page=1&perPage={limit}&serviceKey={DATA_KEY}"
    req = urllib.request.Request(url, headers={'User-Agent': 'Mozilla/5.0'})
    try:
        data = json.loads(urllib.request.urlopen(req, timeout=10).read())
        results = []
        keywords = ['AI', '인공지능', '디지털', '창업', '소상공인', '중소기업', '기술', '혁신']
        for item in data.get('data', []):
            name = item.get('서비스명', '')
            if any(k in name or k in item.get('서비스목적요약', '') for k in keywords):
                results.append({
                    'title': name,
                    'link': f"https://www.gov.kr/portal/rcvfvrSvc/dtlEx/{item.get('서비스ID','')}",
                    'description': item.get('서비스목적요약', '')[:200],
                    'source': '정부24 혜택',
                    'category': 'benefit',
                    'pub_date': datetime.now().strftime('%Y-%m-%d')
                })
        print(f"  정부24 혜택: {len(results)}건 (관련 키워드)")
        return results
    except Exception as e:
        print(f"  정부24 혜택 실패: {e}")
        return []

# === 4. 네이버 뉴스 검색 ===
def fetch_naver_news(query, display=5):
    encoded = urllib.parse.quote(query)
    url = f"https://openapi.naver.com/v1/search/news.json?query={encoded}&display={display}&sort=date"
    req = urllib.request.Request(url, headers={
        'X-Naver-Client-Id': NAVER_ID,
        'X-Naver-Client-Secret': ***
    })
    try:
        data = json.loads(urllib.request.urlopen(req, timeout=10).read())
        results = []
        for item in data.get('items', []):
            results.append({
                'title': clean(item['title']),
                'link': item['link'],
                'description': clean(item['description'])[:200],
                'source': '네이버뉴스',
                'category': 'news',
                'pub_date': datetime.now().strftime('%Y-%m-%d')
            })
        return results
    except Exception as e:
        print(f"  네이버 '{query}' 실패: {e}")
        return []

# === 5. RSS 수집 ===
def fetch_rss(url, source_name, limit=5):
    req = urllib.request.Request(url, headers={'User-Agent': 'Mozilla/5.0'})
    try:
        xml = urllib.request.urlopen(req, timeout=10).read()
        tree = ET.fromstring(xml)
        results = []
        for item in tree.findall('.//item')[:limit]:
            results.append({
                'title': clean(item.findtext('title', '')),
                'link': item.findtext('link', ''),
                'description': clean(item.findtext('description', ''))[:200],
                'source': source_name,
                'category': 'news',
                'pub_date': datetime.now().strftime('%Y-%m-%d')
            })
        return results
    except Exception as e:
        print(f"  RSS {source_name} 실패: {e}")

# ... (67줄 생략)

==================================================
# 완료: 4개, 스킵: 0개
