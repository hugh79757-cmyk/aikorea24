---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection('blog', ({ data }) => !data.draft))
    .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
  return paginate(posts, { pageSize: 9 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const allPosts = (await getCollection('blog', ({ data }) => !data.draft));
const categories = [...new Set(allPosts.map(p => p.data.category))].filter(Boolean);

const emojiMap: Record<string, string> = {
  'AI ë„êµ¬': 'ğŸ› ï¸', 'AI ê°•ì¢Œ': 'ğŸ“š', 'AI ì§€ì›ì‚¬ì—…': 'ğŸ’°',
  'AI ë‰´ìŠ¤': 'ğŸ“°', 'AI ì²´í—˜': 'ğŸ®', 'ì¬í…Œí¬': 'ğŸ’',
};

const pageNum = page.currentPage;
const pageTitle = pageNum === 1 ? 'ë¸”ë¡œê·¸' : `ë¸”ë¡œê·¸ - ${pageNum}í˜ì´ì§€`;
const pageDesc = pageNum === 1
  ? 'AI ë„êµ¬ ë¦¬ë·°, ê°•ì¢Œ, ì§€ì›ì‚¬ì—… ì •ë³´, ë‰´ìŠ¤ë¥¼ í•œêµ­ì–´ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.'
  : `AIì½”ë¦¬ì•„24 ë¸”ë¡œê·¸ ${pageNum}í˜ì´ì§€ - AI ê´€ë ¨ ìµœì‹  ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.`;
---

<Layout title={pageTitle} description={pageDesc}>
  <div class="max-w-6xl mx-auto px-4 py-12">
    <nav class="text-sm text-gray-500 mb-6" aria-label="breadcrumb">
      <ol class="flex items-center gap-1">
        <li><a href="/" class="hover:text-blue-600">í™ˆ</a></li>
        <li class="before:content-['/'] before:mx-1 text-gray-900 font-medium">ë¸”ë¡œê·¸</li>
      </ol>
    </nav>

    <h1 class="text-3xl font-bold text-gray-900 mb-2">ë¸”ë¡œê·¸</h1>
    <p class="text-gray-600 mb-8">AI ê´€ë ¨ ìµœì‹  ì •ë³´ì™€ í™œìš© íŒì„ í™•ì¸í•˜ì„¸ìš”.</p>

    <div class="flex flex-wrap gap-2 mb-8">
      <span class="bg-blue-600 text-white text-sm font-medium px-4 py-1.5 rounded-full">ì „ì²´</span>
      {categories.map(cat => (
        <span class="bg-gray-100 text-gray-700 text-sm font-medium px-4 py-1.5 rounded-full hover:bg-gray-200 cursor-pointer transition-colors">
          {emojiMap[cat] || 'ğŸ“Œ'} {cat}
        </span>
      ))}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {page.data.map(post => {
        const dateFormatted = post.data.date instanceof Date
          ? post.data.date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' })
          : new Date(post.data.date).toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' });
        return (
          <a href={`/blog/${post.id}`} class="group block bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 border border-gray-100">
            {post.data.image ? (
              <div class="aspect-video overflow-hidden">
                <img src={post.data.image} alt={post.data.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" width="400" height="225" loading="lazy" />
              </div>
            ) : (
              <div class="aspect-video bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center">
                <span class="text-5xl">{emojiMap[post.data.category] || 'ğŸ“Œ'}</span>
              </div>
            )}
            <div class="p-5">
              <div class="flex items-center gap-2 mb-2">
                {post.data.category && <span class="text-xs font-semibold text-blue-600">{post.data.category}</span>}
                <span class="text-xs text-gray-400">{dateFormatted}</span>
              </div>
              <h2 class="font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors">{post.data.title}</h2>
              <p class="text-sm text-gray-500 line-clamp-2">{post.data.description}</p>
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="flex gap-1 mt-3 flex-wrap">
                  {post.data.tags.slice(0, 3).map((tag: string) => (
                    <span class="text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded">#{tag}</span>
                  ))}
                </div>
              )}
            </div>
          </a>
        );
      })}
    </div>

    {page.lastPage > 1 && (
      <nav class="flex justify-center items-center gap-2 mt-12" aria-label="í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜">
        {page.url.prev && (
          <a href={page.url.prev} class="px-4 py-2 rounded-lg border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">â† ì´ì „</a>
        )}
        {Array.from({ length: page.lastPage }, (_, i) => i + 1).map(num => (
          <a
            href={num === 1 ? '/blog' : `/blog/${num}`}
            class:list={[
              'w-10 h-10 flex items-center justify-center rounded-lg text-sm font-medium transition-colors',
              num === page.currentPage ? 'bg-blue-600 text-white' : 'text-gray-700 hover:bg-gray-100'
            ]}
          >{num}</a>
        ))}
        {page.url.next && (
          <a href={page.url.next} class="px-4 py-2 rounded-lg border border-gray-300 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">ë‹¤ìŒ â†’</a>
        )}
      </nav>
    )}
  </div>
</Layout>
