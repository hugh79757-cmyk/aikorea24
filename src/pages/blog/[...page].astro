---
export const prerender = true;
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection('blog', ({ data }) => !data.draft))
    .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
  return paginate(posts, { pageSize: 9 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

const categories = [
  { key: 'ì†Œìƒê³µì¸AI', label: 'ì†Œìƒê³µì¸ AI í™œìš©', icon: 'ğŸª' },
  { key: 'AIì…ë¬¸', label: 'AI ì™•ì´ˆë³´ ê°€ì´ë“œ', icon: 'ğŸ“' },
  { key: 'ë°”ì´ë¸Œì½”ë”©', label: 'ë°”ì´ë¸Œì½”ë”© ì‹œì‘', icon: 'ğŸµ' },
  { key: 'ê°œë°œë°°í¬', label: 'ë¬´ë£Œ ì›¹ì‚¬ì´íŠ¸ ë§Œë“¤ê¸°', icon: 'ğŸš€' },
];

const emojiMap: Record<string, string> = {
  'ì†Œìƒê³µì¸AI': 'ğŸª', 'AIì…ë¬¸': 'ğŸ“', 'ë°”ì´ë¸Œì½”ë”©': 'ğŸµ', 'ê°œë°œë°°í¬': 'ğŸš€',
};

const pageNum = page.currentPage;
const pageTitle = pageNum === 1 ? 'ë¸”ë¡œê·¸' : `ë¸”ë¡œê·¸ - ${pageNum}í˜ì´ì§€`;
const pageDesc = pageNum === 1
  ? 'AI ë„êµ¬ ë¦¬ë·°, ê°•ì¢Œ, ì§€ì›ì‚¬ì—… ì •ë³´, ë‰´ìŠ¤ë¥¼ í•œêµ­ì–´ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.'
  : `AIì½”ë¦¬ì•„24 ë¸”ë¡œê·¸ ${pageNum}í˜ì´ì§€ - AI ê´€ë ¨ ìµœì‹  ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.`;
---

<Layout title={pageTitle} description={pageDesc}>
  <div class="max-w-6xl mx-auto px-4 py-12">
    <nav class="text-sm text-gray-500 dark:text-gray-400 mb-6" aria-label="breadcrumb">
      <ol class="flex items-center gap-1">
        <li><a href="/" class="hover:text-blue-600 dark:hover:text-blue-400">í™ˆ</a></li>
        <li class="before:content-['/'] before:mx-1 text-gray-900 dark:text-white font-medium">ë¸”ë¡œê·¸</li>
      </ol>
    </nav>

    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">ë¸”ë¡œê·¸</h1>
    <p class="text-gray-600 dark:text-gray-400 mb-8">AI ê´€ë ¨ ìµœì‹  ì •ë³´ì™€ í™œìš© íŒì„ í™•ì¸í•˜ì„¸ìš”.</p>

    <!-- ì¹´í…Œê³ ë¦¬ ë©”ë‰´ -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-10">
      {categories.map(cat => (
        <button type="button" data-filter={cat.key}
          class="cat-btn group flex items-center gap-2.5 bg-gray-50 dark:bg-white/[0.04] border border-gray-200 dark:border-white/[0.08] rounded-xl px-4 py-3 hover:bg-blue-50 dark:hover:bg-blue-500/10 hover:border-blue-300 dark:hover:border-blue-500/30 transition-all duration-200 cursor-pointer text-left">
          <span class="text-xl flex-shrink-0">{cat.icon}</span>
          <span class="text-sm font-semibold text-gray-800 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">{cat.label}</span>
        </button>
      ))}
    </div>

    <!-- ê¸€ ëª©ë¡ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="blog-grid">
      {page.data.map(post => {
        const dateFormatted = post.data.date instanceof Date
          ? post.data.date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' })
          : new Date(post.data.date).toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' });

        return (
          <a href={`/blog/${post.id}/`} data-category={post.data.category || ''} class="group block bg-white dark:bg-white/[0.05] rounded-2xl overflow-hidden shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 border border-gray-100 dark:border-white/[0.08]">
            {post.data.image ? (
              <div class="aspect-square overflow-hidden">
                <img src={post.data.image} alt={post.data.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" width="400" height="300" loading="lazy" />
              </div>
            ) : (
              <div class="aspect-square bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 flex items-center justify-center">
                <span class="text-5xl">{emojiMap[post.data.category] || 'ğŸ“Œ'}</span>
              </div>
            )}
            <div class="p-5">
              <div class="flex items-center gap-2 mb-2">
                {post.data.category && <span class="text-xs font-semibold text-blue-600 dark:text-blue-400">{post.data.category}</span>}
                <span class="text-xs text-gray-400">{dateFormatted}</span>
              </div>
              <h2 class="font-bold text-gray-900 dark:text-white mb-2 line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">{post.data.title}</h2>
              <p class="text-sm text-gray-500 dark:text-gray-400 line-clamp-2">{post.data.description}</p>
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="flex gap-1 mt-3 flex-wrap">
                  {post.data.tags.slice(0, 3).map((tag: string) => (
                    <span class="text-xs bg-gray-100 dark:bg-white/10 text-gray-500 dark:text-gray-400 px-2 py-0.5 rounded">#{tag}</span>
                  ))}
                </div>
              )}
            </div>
          </a>
        );
      })}
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    {page.lastPage > 1 && (
      <nav class="flex justify-center items-center gap-2 mt-12" aria-label="í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜">
        {page.url.prev && (
          <a href={page.url.prev} class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">â† ì´ì „</a>
        )}
        {Array.from({ length: page.lastPage }, (_, i) => i + 1).map(num => (
          <a
            href={num === 1 ? '/blog/' : `/blog/${num}/`}
            class:list={[
              'w-10 h-10 flex items-center justify-center rounded-lg text-sm font-medium transition-colors',
              num === page.currentPage ? 'bg-blue-600 text-white' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'
            ]}
          >{num}</a>
        ))}
        {page.url.next && (
          <a href={page.url.next} class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">ë‹¤ìŒ â†’</a>
        )}
      </nav>
    )}

    <script is:inline>
      let activeFilter = null;
      document.querySelectorAll('.cat-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const cat = btn.dataset.filter;
          if (activeFilter === cat) {
            activeFilter = null;
            btn.classList.remove('!bg-blue-100', 'dark:!bg-blue-500/20', '!border-blue-400', 'dark:!border-blue-500/50');
          } else {
            document.querySelectorAll('.cat-btn').forEach(b => {
              b.classList.remove('!bg-blue-100', 'dark:!bg-blue-500/20', '!border-blue-400', 'dark:!border-blue-500/50');
            });
            btn.classList.add('!bg-blue-100', 'dark:!bg-blue-500/20', '!border-blue-400', 'dark:!border-blue-500/50');
            activeFilter = cat;
          }
          document.querySelectorAll('#blog-grid > a').forEach(card => {
            if (!activeFilter) { card.style.display = ''; }
            else { card.style.display = (card.dataset.category === activeFilter) ? '' : 'none'; }
          });
        });
      });
    </script>
  </div>
</Layout>
