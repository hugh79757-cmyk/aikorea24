---
export const prerender = true;
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection('blog', ({ data }) => !data.draft))
    .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
  return paginate(posts, { pageSize: 9 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const allPosts = (await getCollection('blog', ({ data }) => !data.draft));
const categories = [...new Set(allPosts.map(p => p.data.category))].filter(Boolean);

const emojiMap: Record<string, string> = {
  'AI ë„êµ¬': 'ğŸ› ï¸', 'AI ê°•ì¢Œ': 'ğŸ“š', 'AI ì§€ì›ì‚¬ì—…': 'ğŸ’°',
  'AI ë‰´ìŠ¤': 'ğŸ“°', 'AI ì²´í—˜': 'ğŸ®', 'ì¬í…Œí¬': 'ğŸ’',
};

const pageNum = page.currentPage;
const pageTitle = pageNum === 1 ? 'ë¸”ë¡œê·¸' : `ë¸”ë¡œê·¸ - ${pageNum}í˜ì´ì§€`;
const pageDesc = pageNum === 1
  ? 'AI ë„êµ¬ ë¦¬ë·°, ê°•ì¢Œ, ì§€ì›ì‚¬ì—… ì •ë³´, ë‰´ìŠ¤ë¥¼ í•œêµ­ì–´ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.'
  : `AIì½”ë¦¬ì•„24 ë¸”ë¡œê·¸ ${pageNum}í˜ì´ì§€ - AI ê´€ë ¨ ìµœì‹  ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.`;
---

<Layout title={pageTitle} description={pageDesc}>
  <div class="max-w-6xl mx-auto px-4 py-12">
    <nav class="text-sm text-gray-500 mb-6" aria-label="breadcrumb">
      <ol class="flex items-center gap-1">
        <li><a href="/" class="hover:text-blue-600">í™ˆ</a></li>
        <li class="before:content-['/'] before:mx-1 text-gray-900 font-medium">ë¸”ë¡œê·¸</li>
      </ol>
    </nav>

    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">ë¸”ë¡œê·¸</h1>
    <p class="text-gray-600 dark:text-gray-400 mb-8">AI ê´€ë ¨ ìµœì‹  ì •ë³´ì™€ í™œìš© íŒì„ í™•ì¸í•˜ì„¸ìš”.</p>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="blog-grid">
      {page.data.map(post => {
        const dateFormatted = post.data.date instanceof Date
          ? post.data.date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' })
          : new Date(post.data.date).toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' });
        return (
          <a href={`/blog/${post.id}/`} data-category={post.data.category || ''} class="group block bg-white dark:bg-white/[0.05] rounded-2xl overflow-hidden shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 border border-gray-100 dark:border-white/[0.08]">
            {post.data.image ? (
              <div class="aspect-square overflow-hidden">
                <img src={post.data.image} alt={post.data.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" width="400" height="300" loading="lazy" />
              </div>
            ) : (
              <div class="aspect-square bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 flex items-center justify-center">
                <span class="text-5xl">{emojiMap[post.data.category] || 'ğŸ“Œ'}</span>
              </div>
            )}
            <div class="p-5">
              <div class="flex items-center gap-2 mb-2">
                {post.data.category && <span class="text-xs font-semibold text-blue-600 dark:text-blue-400">{post.data.category}</span>}
                <span class="text-xs text-gray-400">{dateFormatted}</span>
              </div>
              <h2 class="font-bold text-gray-900 dark:text-white mb-2 line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">{post.data.title}</h2>
              <p class="text-sm text-gray-500 dark:text-gray-400 line-clamp-2">{post.data.description}</p>
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="flex gap-1 mt-3 flex-wrap">
                  {post.data.tags.slice(0, 3).map((tag: string) => (
                    <span class="text-xs bg-gray-100 dark:bg-white/10 text-gray-500 dark:text-gray-400 px-2 py-0.5 rounded">#{tag}</span>
                  ))}
                </div>
              )}
            </div>
          </a>
        );
      })}
    </div>

    {page.lastPage > 1 && (
      <nav class="flex justify-center items-center gap-2 mt-12" aria-label="í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜">
        {page.url.prev && (
          <a href={page.url.prev} class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">â† ì´ì „</a>
        )}
        {Array.from({ length: page.lastPage }, (_, i) => i + 1).map(num => (
          <a
            href={num === 1 ? '/blog/' : `/blog/${num}/`}
            class:list={[
              'w-10 h-10 flex items-center justify-center rounded-lg text-sm font-medium transition-colors',
              num === page.currentPage ? 'bg-blue-600 text-white' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'
            ]}
          >{num}</a>
        ))}
        {page.url.next && (
          <a href={page.url.next} class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">ë‹¤ìŒ â†’</a>
        )}
      </nav>
    )}

    <!-- ì¹´í…Œê³ ë¦¬ í•„í„°: í•˜ë‹¨ ë°°ì¹˜, ìµœëŒ€ 5ê°œ -->
    <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
      <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-4">ì¹´í…Œê³ ë¦¬</h3>
      <div class="flex flex-wrap gap-2" id="category-filter">
        <button type="button" class="bg-blue-600 text-white text-sm font-medium px-4 py-1.5 rounded-full cursor-pointer transition-colors" data-category="all">ì „ì²´</button>
        {categories.slice(0, 5).map(cat => (
          <button type="button" class="bg-gray-100 dark:bg-white/10 text-gray-700 dark:text-gray-300 text-sm font-medium px-4 py-1.5 rounded-full hover:bg-gray-200 dark:hover:bg-white/20 cursor-pointer transition-colors" data-category={cat}>
            {emojiMap[cat] || 'ğŸ“Œ'} {cat}
          </button>
        ))}
      </div>
    </div>

    <script is:inline>
      document.querySelectorAll('#category-filter button').forEach(btn => {
        btn.addEventListener('click', () => {
          const cat = btn.dataset.category;
          document.querySelectorAll('#category-filter button').forEach(b => {
            b.classList.remove('bg-blue-600', 'text-white');
            b.classList.add('bg-gray-100', 'dark:bg-white/10', 'text-gray-700', 'dark:text-gray-300');
          });
          btn.classList.remove('bg-gray-100', 'dark:bg-white/10', 'text-gray-700', 'dark:text-gray-300');
          btn.classList.add('bg-blue-600', 'text-white');
          document.querySelectorAll('#blog-grid > a').forEach(card => {
            if (cat === 'all') { card.style.display = ''; }
            else { card.style.display = (card.dataset.category === cat) ? '' : 'none'; }
          });
        });
      });
    </script>
  </div>
</Layout>
