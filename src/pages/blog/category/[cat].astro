---
export const prerender = true;
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

const categoryMeta: Record<string, { label: string; icon: string; desc: string }> = {
  'AI ê°•ì¢Œ': { label: 'AI ê°•ì¢Œ', icon: 'ğŸ“š', desc: 'AI í”„ë¡¬í”„íŠ¸ ê³µì‹ê³¼ í™œìš©ë²•ì„ ë°°ì›Œë³´ì„¸ìš”.' },
  'ì†Œìƒê³µì¸AI': { label: 'ì†Œìƒê³µì¸ AI í™œìš©', icon: 'ğŸª', desc: 'ì†Œìƒê³µì¸ì„ ìœ„í•œ AI ì§€ì›ê¸ˆ, ë°”ìš°ì²˜, í™œìš© ê°€ì´ë“œ.' },
  'AIì…ë¬¸': { label: 'AI ì™•ì´ˆë³´ ê°€ì´ë“œ', icon: 'ğŸ“', desc: 'AIê°€ ì²˜ìŒì´ì–´ë„ ê´œì°®ì•„ìš”. í•˜ë‚˜ì”© ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.' },
  'ë°”ì´ë¸Œì½”ë”©': { label: 'ë°”ì´ë¸Œì½”ë”© ì‹œì‘', icon: 'ğŸµ', desc: 'ì½”ë”© ì—†ì´ AIì—ê²Œ ë§ë¡œ ê°œë°œí•˜ëŠ” ë°”ì´ë¸Œì½”ë”©.' },
  'ê°œë°œë°°í¬': { label: 'ë¬´ë£Œ ì›¹ì‚¬ì´íŠ¸ ë§Œë“¤ê¸°', icon: 'ğŸš€', desc: 'GitHub, Cloudflareë¡œ ë¬´ë£Œ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë§Œë“¤ê³  ë°°í¬í•˜ì„¸ìš”.' },
  'ë‰´ìŠ¤': { label: 'ë‰´ìŠ¤ ë¸Œë¦¬í•‘', icon: 'ğŸ“°', desc: 'ë§¤ì¼ íë ˆì´íŒ…ëœ AI ë‰´ìŠ¤ë¥¼ ê¹Šì´ ìˆê²Œ ë‹¤ë£¹ë‹ˆë‹¤.' },
};

export const getStaticPaths = (() => {
  const cats: Record<string, { label: string; icon: string; desc: string }> = {
    'AI ê°•ì¢Œ': { label: 'AI ê°•ì¢Œ', icon: 'ğŸ“š', desc: 'AI í”„ë¡¬í”„íŠ¸ ê³µì‹ê³¼ í™œìš©ë²•ì„ ë°°ì›Œë³´ì„¸ìš”.' },
    'ì†Œìƒê³µì¸AI': { label: 'ì†Œìƒê³µì¸ AI í™œìš©', icon: 'ğŸª', desc: 'ì†Œìƒê³µì¸ì„ ìœ„í•œ AI ì§€ì›ê¸ˆ, ë°”ìš°ì²˜, í™œìš© ê°€ì´ë“œ.' },
    'AIì…ë¬¸': { label: 'AI ì™•ì´ˆë³´ ê°€ì´ë“œ', icon: 'ğŸ“', desc: 'AIê°€ ì²˜ìŒì´ì–´ë„ ê´œì°®ì•„ìš”. í•˜ë‚˜ì”© ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.' },
    'ë°”ì´ë¸Œì½”ë”©': { label: 'ë°”ì´ë¸Œì½”ë”© ì‹œì‘', icon: 'ğŸµ', desc: 'ì½”ë”© ì—†ì´ AIì—ê²Œ ë§ë¡œ ê°œë°œí•˜ëŠ” ë°”ì´ë¸Œì½”ë”©.' },
    'ê°œë°œë°°í¬': { label: 'ë¬´ë£Œ ì›¹ì‚¬ì´íŠ¸ ë§Œë“¤ê¸°', icon: 'ğŸš€', desc: 'GitHub, Cloudflareë¡œ ë¬´ë£Œ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë§Œë“¤ê³  ë°°í¬í•˜ì„¸ìš”.' },
  'ë‰´ìŠ¤': { label: 'ë‰´ìŠ¤ ë¸Œë¦¬í•‘', icon: 'ğŸ“°', desc: 'ë§¤ì¼ íë ˆì´íŒ…ëœ AI ë‰´ìŠ¤ë¥¼ ê¹Šì´ ìˆê²Œ ë‹¤ë£¹ë‹ˆë‹¤.' },
  };
  return Object.keys(cats).map(cat => ({
    params: { cat },
  }));
}) satisfies GetStaticPaths;

const { cat } = Astro.params;
const meta = categoryMeta[cat] || { label: cat, icon: 'ğŸ“Œ', desc: '' };

const posts = (await getCollection('blog', ({ data }) => !data.draft && data.category === cat))
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const emojiMap: Record<string, string> = {
  'AI ê°•ì¢Œ': 'ğŸ“š', 'ì†Œìƒê³µì¸AI': 'ğŸª', 'AIì…ë¬¸': 'ğŸ“', 'ë°”ì´ë¸Œì½”ë”©': 'ğŸµ', 'ê°œë°œë°°í¬': 'ğŸš€', 'ë‰´ìŠ¤': 'ğŸ“°',
};
---

<Layout title={`${meta.label} - ë¸”ë¡œê·¸`} description={meta.desc}>
  <div class="max-w-6xl mx-auto px-4 py-12">
    <nav class="text-sm text-gray-500 dark:text-gray-400 mb-6" aria-label="breadcrumb">
      <ol class="flex items-center gap-1">
        <li><a href="/" class="hover:text-blue-600 dark:hover:text-blue-400">í™ˆ</a></li>
        <li class="before:content-['/'] before:mx-1"><a href="/blog/" class="hover:text-blue-600 dark:hover:text-blue-400">ë¸”ë¡œê·¸</a></li>
        <li class="before:content-['/'] before:mx-1 text-gray-900 dark:text-white font-medium">{meta.label}</li>
      </ol>
    </nav>

    <div class="flex items-center gap-3 mb-2">
      <span class="text-3xl">{meta.icon}</span>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white">{meta.label}</h1>
    </div>
    <p class="text-gray-600 dark:text-gray-400 mb-8">{meta.desc}</p>
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">ì´ <strong class="text-gray-900 dark:text-white">{posts.length}</strong>ê°œì˜ ê¸€</p>

    {posts.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {posts.map(post => {
          const dateFormatted = post.data.date instanceof Date
            ? post.data.date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' })
            : new Date(post.data.date).toLocaleDateString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric' });
          return (
            <a href={`/blog/${post.id}/`} class="group block bg-white dark:bg-white/[0.05] rounded-2xl overflow-hidden shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 border border-gray-100 dark:border-white/[0.08]">
              {post.data.image ? (
                <div class="aspect-square overflow-hidden">
                  <img src={post.data.image} alt={post.data.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" width="400" height="300" loading="lazy" />
                </div>
              ) : (
                <div class="aspect-square bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 flex items-center justify-center">
                  <span class="text-5xl">{emojiMap[post.data.category] || 'ğŸ“Œ'}</span>
                </div>
              )}
              <div class="p-5">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-xs font-semibold text-blue-600 dark:text-blue-400">{post.data.category}</span>
                  <span class="text-xs text-gray-400">{dateFormatted}</span>
                </div>
                <h2 class="font-bold text-gray-900 dark:text-white mb-2 line-clamp-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">{post.data.title}</h2>
                <p class="text-sm text-gray-500 dark:text-gray-400 line-clamp-2">{post.data.description}</p>
                {post.data.tags && post.data.tags.length > 0 && (
                  <div class="flex gap-1 mt-3 flex-wrap">
                    {post.data.tags.slice(0, 3).map((tag: string) => (
                      <span class="text-xs bg-gray-100 dark:bg-white/10 text-gray-500 dark:text-gray-400 px-2 py-0.5 rounded">#{tag}</span>
                    ))}
                  </div>
                )}
              </div>
            </a>
          );
        })}
      </div>
    ) : (
      <div class="bg-gray-100 dark:bg-white/[0.05] rounded-2xl p-8 text-center">
        <p class="text-gray-400">ì•„ì§ ë“±ë¡ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
    )}

    <div class="mt-10 text-center">
      <a href="/blog/" class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium">â† ì „ì²´ ë¸”ë¡œê·¸ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>
</Layout>
